@inherits AutoFormEntryBase

@if (Metadata != null)
{
    var attr = Metadata.Attribute;
    var displayName = Metadata.GetDisplayName();
    var required = Metadata.IsRequired;
    var element = attr.GetElement(out var elementType);
    var editor = attr.RichText || true == Form?.EnableRichText && element.EqualsIgnoreCase("textarea");
    var wrapperClass = $"{(editor ? "rich-text-editor mb-3" : "form-floating")} {element} {elementType}";
    var placeholder = editor ? null : attr.Placeholder ?? attr.Prompt ?? attr.Description;
    if (!editor && placeholder.IsBlank())
    {
        placeholder = displayName;
    }
    var attributes = GetAttributes
    (
        ("class", attr.InputCssClass),
        ("placeholder", placeholder),
        ("title", attr.Description)
    );
    <div class="@wrapperClass">
        @if (editor)
        {
            <QuillEditor Target="@("#" + Id)" />
            var labelAttr = GetAttributes(("class", Metadata.IsRequired ? "required" : null));
            <label @attributes="@labelAttr">@displayName</label>
        }
        <AutoInputBase @ref="autoInputBaseRef" @bind-Value="Value" Id="@Id" Name="@Name" Metadata="Metadata" Model="Model" PropertyNavigationPath="@PropertyNavigationPath" @attributes="attributes">
            @ChildContent
        </AutoInputBase>
        @if (!editor)
        {
            var labelAttr = GetAttributes
            (
                ("for", editor ? null : autoInputBaseRef?.Id),
                ("class", Metadata.IsRequired ? "required" : null)
            );
            <label @attributes="@labelAttr">@displayName</label>
        }
        @if (editor)
        {
            <HelpText Description="@attr.Description" />
        }
    </div>
    @*<AutoValidationMessage Model="Model" Property="@Metadata.PropertyInfo.Name" />*@
}

@code {
    private AutoInputBase? autoInputBaseRef;
    [Parameter] public RenderFragment? ChildContent { get; set; }
}
